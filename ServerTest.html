<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Unity Multi-Controller</title>
    <style>
        /* Grunddesign */
        body {
            font-family: sans-serif;
            margin: 0;
            background: #1a1a1a;
            color: white;
            overflow: hidden; /* Verhindert Scrollen am Handy */
            height: 100vh;
        }

        /* Container für alle Fenster */
        .screen {
            display: none; /* Standardmäßig unsichtbar */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100vw;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Das aktive Fenster anzeigen */
        .screen.active {
            display: flex;
        }

        /* Styling für Inputs & Buttons */
        input { padding: 15px; margin: 10px; width: 80%; border-radius: 8px; border: none; font-size: 1.1rem; }
        button { 
            padding: 20px; margin: 10px; width: 80%; font-size: 1.5rem; font-weight: bold;
            border-radius: 12px; border: none; background: #007bff; color: white; cursor: pointer;
        }
        button:active { transform: scale(0.98); background: #0056b3; }

        /* Spezielle Controller-Layouts */
        .grid-controller {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 100%;
        }
        
        #status-bar { position: fixed; bottom: 0; width: 100%; text-align: center; font-size: 12px; padding: 5px; color: #666; }
    </style>
</head>
<body>

    <section id="screen-login" class="screen active">
        <h2>Mit PC verbinden</h2>
        <input type="text" id="ipInput" placeholder="IP Adresse" value="192.168.0.55">
        <button onclick="connect()">VERBINDEN</button>
    </section>

    <section id="screen-lobby" class="screen">
        <h2>Warte auf Spielstart...</h2>
        <p>Du bist verbunden.</p>
        <div class="loader"></div>
    </section>

    <section id="screen-game-jump" class="screen">
        <h2>Jump Game</h2>
        <button style="height: 200px; background: #28a745;" onclick="sendAction('jump')">JUMP!</button>
    </section>

    <section id="screen-game-quiz" class="screen">
        <h2>Quiz Modus</h2>
        <div class="grid-controller">
            <button onclick="sendAction('A')" style="background: #dc3545;">A</button>
            <button onclick="sendAction('B')" style="background: #ffc107;">B</button>
        </div>
    </section>

    <div id="status-bar">Status: Getrennt</div>

    <script>
        let socket;
        const statusBar = document.getElementById('status-bar');

        // Funktion zum Wechseln der Fenster
        function showScreen(screenId) {
            // Alle Screens verstecken
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            // Gewünschten Screen zeigen
            document.getElementById(screenId).classList.add('active');
        }

        function connect() {
            const ip = document.getElementById('ipInput').value;
            statusBar.innerText = "Status: Verbinde...";

            socket = new WebSocket(`ws://${ip}:8080/game`);

            socket.onopen = () => {
                statusBar.innerText = "Status: Verbunden";
                showScreen('screen-lobby'); // Automatisch zur Lobby wechseln
                socket.send(JSON.stringify({ type: "ready", user: "Player1" }));
            };

            socket.onmessage = (event) => {
                const data = JSON.parse(event.data);
                console.log("Vom PC:", data);

                // Dynamischer Wechsel basierend auf Nachricht vom PC
                if (data.command === "SWITCH_SCREEN") {
                    showScreen(data.target); // z.B. "screen-game-jump"
                }

                if (data.command === "VIBRATE") {
                    if (navigator.vibrate) navigator.vibrate(100);
                }
            };

            socket.onclose = () => {
                statusBar.innerText = "Status: Getrennt";
                showScreen('screen-login');
            };
        }

        function sendAction(actionName) {
            if (socket && socket.readyState === WebSocket.OPEN) {
                // Wir senden ein JSON-Objekt für bessere Skalierbarkeit
                const msg = {
                    type: "action",
                    value: actionName,
                    time: Date.now()
                };
                socket.send(JSON.stringify(msg));
            }
        }
    </script>
</body>
</html>